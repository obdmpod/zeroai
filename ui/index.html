<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ZeroClaw</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet" />
  <style>
/* ═══════════════════════════════════════════════════════════════
   DESIGN TOKENS — Dark theme (default)
   ═══════════════════════════════════════════════════════════════ */
:root {
  /* Backgrounds */
  --bg: #12141a;
  --bg-accent: #14161d;
  --bg-elevated: #1a1d25;
  --bg-hover: #262a35;
  --bg-muted: #1e2028;

  /* Cards & surfaces */
  --card: #181b22;
  --card-foreground: #f4f4f5;
  --card-highlight: rgba(255, 255, 255, 0.05);

  /* Text */
  --text: #e4e4e7;
  --text-strong: #fafafa;
  --muted: #71717a;
  --muted-strong: #a1a1aa;

  /* Borders */
  --border: #27272a;
  --border-strong: #3f3f46;
  --border-hover: #52525b;

  /* Accent (red) */
  --accent: #ff5c5c;
  --accent-hover: #ff7070;
  --accent-subtle: rgba(255, 92, 92, 0.15);
  --accent-glow: rgba(255, 92, 92, 0.25);

  /* Secondary accent (teal) */
  --accent-2: #14b8a6;

  /* Semantic */
  --ok: #22c55e;
  --warn: #f59e0b;
  --danger: #ef4444;
  --info: #3b82f6;

  /* Focus */
  --focus-ring: rgba(255, 92, 92, 0.4);

  /* Shadows */
  --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.2);
  --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.25), 0 0 0 1px rgba(255, 255, 255, 0.03);
  --shadow-lg: 0 12px 28px rgba(0, 0, 0, 0.35), 0 0 0 1px rgba(255, 255, 255, 0.03);

  /* Radii */
  --radius-sm: 6px;
  --radius-md: 8px;
  --radius-lg: 12px;
  --radius-xl: 16px;
  --radius-full: 9999px;

  /* Transitions */
  --ease-out: cubic-bezier(0.16, 1, 0.3, 1);
  --ease-in-out: cubic-bezier(0.4, 0, 0.2, 1);
  --ease-spring: cubic-bezier(0.34, 1.56, 0.64, 1);
  --duration-fast: 120ms;
  --duration-normal: 200ms;
  --duration-slow: 350ms;

  /* Typography */
  --font-body: "Space Grotesk", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  --font-mono: "JetBrains Mono", ui-monospace, SFMono-Regular, "SF Mono", Menlo, Monaco, Consolas, monospace;

  /* Scrollbar */
  --scrollbar-thumb: #3f3f46;
  --scrollbar-track: transparent;

  /* Chat */
  --chat-text: #e4e4e7;
  --chat-compose-bg: rgba(18, 20, 26, 0.85);
}

/* ═══════════════════════════════════════════════════════════════
   LIGHT THEME
   ═══════════════════════════════════════════════════════════════ */
:root[data-theme="light"] {
  --bg: #fafafa;
  --bg-accent: #f5f5f5;
  --bg-elevated: #ffffff;
  --bg-hover: #f0f0f0;
  --bg-muted: #f4f4f5;

  --card: #ffffff;
  --card-foreground: #18181b;
  --card-highlight: rgba(0, 0, 0, 0.03);

  --text: #3f3f46;
  --text-strong: #18181b;
  --muted: #a1a1aa;
  --muted-strong: #71717a;

  --border: #e4e4e7;
  --border-strong: #d4d4d8;
  --border-hover: #a1a1aa;

  --accent: #dc2626;
  --accent-hover: #ef4444;
  --accent-subtle: rgba(220, 38, 38, 0.1);
  --accent-glow: rgba(220, 38, 38, 0.2);

  --focus-ring: rgba(220, 38, 38, 0.3);

  --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.06);
  --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.08), 0 0 0 1px rgba(0, 0, 0, 0.04);
  --shadow-lg: 0 12px 28px rgba(0, 0, 0, 0.12), 0 0 0 1px rgba(0, 0, 0, 0.04);

  --scrollbar-thumb: #d4d4d8;

  --chat-text: #3f3f46;
  --chat-compose-bg: rgba(250, 250, 250, 0.85);
}

/* ═══════════════════════════════════════════════════════════════
   BASE RESET & GLOBAL
   ═══════════════════════════════════════════════════════════════ */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

html {
  height: 100%;
  -webkit-text-size-adjust: 100%;
}

body {
  font-family: var(--font-body);
  font-size: 14px;
  line-height: 1.55;
  letter-spacing: -0.02em;
  color: var(--text);
  background: var(--bg);
  height: 100%;
  overflow: hidden;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  transition: background var(--duration-normal) var(--ease-out),
              color var(--duration-normal) var(--ease-out);
}

/* Scrollbar */
::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-track { background: var(--scrollbar-track); }
::-webkit-scrollbar-thumb {
  background: var(--scrollbar-thumb);
  border-radius: var(--radius-full);
}
::-webkit-scrollbar-thumb:hover { background: var(--border-hover); }

/* Focus */
:focus-visible {
  outline: 2px solid var(--focus-ring);
  outline-offset: 2px;
}

a { color: var(--accent); text-decoration: none; }
a:hover { text-decoration: underline; }

/* ═══════════════════════════════════════════════════════════════
   SHELL LAYOUT
   ═══════════════════════════════════════════════════════════════ */
.shell {
  display: flex;
  flex-direction: column;
  height: 100%;
}

/* TOPBAR */
.topbar {
  height: 56px;
  display: flex;
  align-items: center;
  padding: 0 20px;
  border-bottom: 1px solid var(--border);
  background: var(--bg);
  flex-shrink: 0;
  gap: 12px;
  z-index: 10;
}

.topbar-brand {
  display: flex;
  align-items: center;
  gap: 10px;
  flex-shrink: 0;
}

.topbar-brand svg {
  width: 28px;
  height: 28px;
  color: var(--accent);
}

.topbar-brand-text {
  font-size: 16px;
  font-weight: 600;
  color: var(--text-strong);
  letter-spacing: -0.03em;
}

.topbar-spacer { flex: 1; }

.topbar-status {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 12px;
  color: var(--muted);
  padding: 4px 10px;
  border-radius: var(--radius-full);
  background: var(--bg-muted);
  border: 1px solid var(--border);
}

.status-dot {
  width: 7px;
  height: 7px;
  border-radius: 50%;
  flex-shrink: 0;
}
.status-dot.ok { background: var(--ok); box-shadow: 0 0 6px rgba(34, 197, 94, 0.4); }
.status-dot.warn { background: var(--warn); }
.status-dot.error { background: var(--danger); }
.status-dot.unknown { background: var(--muted); }

.topbar-actions {
  display: flex;
  align-items: center;
  gap: 4px;
}

/* Icon button */
.icon-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 36px;
  height: 36px;
  border: none;
  background: transparent;
  color: var(--muted);
  border-radius: var(--radius-md);
  cursor: pointer;
  transition: background var(--duration-fast) var(--ease-out),
              color var(--duration-fast) var(--ease-out);
}
.icon-btn:hover {
  background: var(--bg-hover);
  color: var(--text-strong);
}
.icon-btn svg { width: 18px; height: 18px; }

/* CONTENT */
.content {
  flex: 1;
  overflow: hidden;
  display: flex;
  flex-direction: column;
}

/* ═══════════════════════════════════════════════════════════════
   VIEWS
   ═══════════════════════════════════════════════════════════════ */
.view { display: none; flex: 1; overflow: hidden; }
.view.active { display: flex; flex-direction: column; }

/* ═══════════════════════════════════════════════════════════════
   PAIRING VIEW
   ═══════════════════════════════════════════════════════════════ */
.pair-view {
  justify-content: center;
  align-items: center;
  padding: 24px;
  animation: fadeIn var(--duration-slow) var(--ease-out);
}

.pair-card {
  width: 100%;
  max-width: 400px;
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: var(--radius-xl);
  padding: 40px 32px;
  box-shadow: var(--shadow-lg);
  text-align: center;
}

.pair-card-icon {
  width: 56px;
  height: 56px;
  margin: 0 auto 20px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--accent-subtle);
  border-radius: var(--radius-lg);
  color: var(--accent);
}
.pair-card-icon svg { width: 28px; height: 28px; }

.pair-card h2 {
  font-size: 20px;
  font-weight: 600;
  color: var(--text-strong);
  margin-bottom: 8px;
}

.pair-card p {
  font-size: 13px;
  color: var(--muted);
  margin-bottom: 24px;
  line-height: 1.5;
}

.pair-input {
  width: 100%;
  max-width: 200px;
  margin: 0 auto;
  display: block;
  padding: 12px 16px;
  font-family: var(--font-mono);
  font-size: 20px;
  font-weight: 500;
  letter-spacing: 0.3em;
  text-align: center;
  color: var(--text-strong);
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: var(--radius-md);
  transition: border-color var(--duration-fast) var(--ease-out),
              box-shadow var(--duration-fast) var(--ease-out);
}
.pair-input:focus {
  border-color: var(--accent);
  box-shadow: 0 0 0 3px var(--focus-ring);
  outline: none;
}
.pair-input::placeholder {
  color: var(--muted);
  letter-spacing: 0.3em;
}

/* ═══════════════════════════════════════════════════════════════
   BUTTONS
   ═══════════════════════════════════════════════════════════════ */
.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  padding: 10px 20px;
  font-family: var(--font-body);
  font-size: 13px;
  font-weight: 500;
  letter-spacing: -0.01em;
  border: 1px solid transparent;
  border-radius: var(--radius-md);
  cursor: pointer;
  transition: all var(--duration-fast) var(--ease-out);
  user-select: none;
}

.btn-primary {
  background: var(--accent);
  color: #fff;
  border-color: transparent;
}
.btn-primary:hover {
  background: var(--accent-hover);
  transform: translateY(-1px);
  box-shadow: 0 4px 12px var(--accent-glow);
}
.btn-primary:active {
  transform: translateY(0);
}
.btn-primary:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
  box-shadow: none;
}

.btn-ghost {
  background: transparent;
  color: var(--muted);
  border-color: transparent;
}
.btn-ghost:hover {
  color: var(--text);
  background: var(--bg-hover);
}

.btn-full {
  width: 100%;
  margin-top: 16px;
}

/* ═══════════════════════════════════════════════════════════════
   ERROR MESSAGE
   ═══════════════════════════════════════════════════════════════ */
.error-msg {
  font-size: 13px;
  color: var(--danger);
  margin-top: 12px;
  min-height: 20px;
}

/* ═══════════════════════════════════════════════════════════════
   CHAT VIEW
   ═══════════════════════════════════════════════════════════════ */
.chat-view {
  position: relative;
}

.chat-thread {
  flex: 1;
  overflow-y: auto;
  padding: 16px 16px 8px;
}

.chat-thread-inner {
  max-width: 800px;
  margin: 0 auto;
}

/* Empty state */
.chat-empty {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100%;
  color: var(--muted);
  text-align: center;
  padding: 40px;
  animation: fadeIn var(--duration-slow) var(--ease-out);
}
.chat-empty svg {
  width: 48px;
  height: 48px;
  margin-bottom: 16px;
  opacity: 0.4;
}
.chat-empty h3 {
  font-size: 16px;
  font-weight: 500;
  color: var(--text);
  margin-bottom: 6px;
}
.chat-empty p {
  font-size: 13px;
  max-width: 300px;
}

/* Message groups */
.chat-group {
  display: flex;
  gap: 12px;
  margin-bottom: 20px;
  animation: fadeIn var(--duration-normal) var(--ease-out);
}
.chat-group.user {
  flex-direction: row-reverse;
}

.chat-avatar {
  width: 36px;
  height: 36px;
  border-radius: var(--radius-md);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 14px;
  font-weight: 600;
  flex-shrink: 0;
  margin-top: 2px;
}
.chat-avatar.assistant-avatar {
  background: var(--bg-elevated);
  border: 1px solid var(--border);
  color: var(--accent);
}
.chat-avatar.user-avatar {
  background: var(--accent-subtle);
  color: var(--accent);
}

.chat-group-body {
  max-width: min(720px, calc(100% - 52px));
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.chat-sender {
  font-size: 12px;
  font-weight: 500;
  color: var(--muted-strong);
  margin-bottom: 4px;
  padding: 0 2px;
}
.chat-group.user .chat-sender {
  text-align: right;
}

.chat-bubble {
  position: relative;
  padding: 10px 14px;
  border-radius: var(--radius-lg);
  font-size: 14px;
  line-height: 1.6;
  color: var(--chat-text);
  word-break: break-word;
}
.chat-group.assistant .chat-bubble {
  background: var(--card);
  border: 1px solid var(--border);
}
.chat-group.user .chat-bubble {
  background: var(--accent-subtle);
  border: 1px solid rgba(255, 92, 92, 0.1);
}

/* Streaming pulse */
.chat-bubble.streaming {
  border-color: var(--accent);
  animation: streamPulse 1.5s ease-in-out infinite;
}

/* Copy button */
.chat-bubble .copy-btn {
  position: absolute;
  top: 6px;
  right: 6px;
  width: 28px;
  height: 28px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--bg-elevated);
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  color: var(--muted);
  cursor: pointer;
  opacity: 0;
  transition: opacity var(--duration-fast) var(--ease-out),
              color var(--duration-fast) var(--ease-out);
}
.chat-bubble:hover .copy-btn { opacity: 1; }
.copy-btn:hover { color: var(--text-strong); }
.copy-btn svg { width: 14px; height: 14px; }
.copy-btn.copied { color: var(--ok); }

/* ── Markdown content inside bubbles ── */
.chat-bubble p { margin: 0 0 8px; }
.chat-bubble p:last-child { margin-bottom: 0; }

.chat-bubble strong { font-weight: 600; color: var(--text-strong); }
.chat-bubble em { font-style: italic; }

.chat-bubble code {
  font-family: var(--font-mono);
  font-size: 12.5px;
  background: rgba(0, 0, 0, 0.15);
  padding: 0.15em 0.4em;
  border-radius: 4px;
}
:root[data-theme="light"] .chat-bubble code {
  background: rgba(0, 0, 0, 0.07);
}

.chat-bubble pre {
  margin: 8px 0;
  background: rgba(0, 0, 0, 0.2);
  border-radius: var(--radius-md);
  padding: 12px 14px;
  overflow-x: auto;
  position: relative;
}
:root[data-theme="light"] .chat-bubble pre {
  background: rgba(0, 0, 0, 0.05);
}
.chat-bubble pre code {
  background: none;
  padding: 0;
  font-size: 12.5px;
  line-height: 1.5;
}

/* Code block copy button */
.code-copy-btn {
  position: absolute;
  top: 8px;
  right: 8px;
  width: 28px;
  height: 28px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--bg-elevated);
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  color: var(--muted);
  cursor: pointer;
  opacity: 0;
  transition: opacity var(--duration-fast) var(--ease-out);
}
.chat-bubble pre:hover .code-copy-btn { opacity: 1; }
.code-copy-btn:hover { color: var(--text-strong); }
.code-copy-btn svg { width: 14px; height: 14px; }
.code-copy-btn.copied { color: var(--ok); }

.chat-bubble blockquote {
  border-left: 3px solid var(--border-strong);
  padding: 4px 12px;
  margin: 8px 0;
  color: var(--muted-strong);
  background: rgba(255, 255, 255, 0.02);
  border-radius: 0 var(--radius-sm) var(--radius-sm) 0;
}
:root[data-theme="light"] .chat-bubble blockquote {
  background: rgba(0, 0, 0, 0.02);
}

.chat-bubble ul, .chat-bubble ol {
  margin: 6px 0;
  padding-left: 20px;
}
.chat-bubble li { margin-bottom: 2px; }
.chat-bubble li::marker { color: var(--muted); }

.chat-bubble a {
  color: var(--accent);
  text-decoration: underline;
  text-underline-offset: 2px;
}

.chat-bubble hr {
  border: none;
  border-top: 1px solid var(--border);
  margin: 12px 0;
}

/* Thinking/loading dots */
.thinking-dots {
  display: inline-flex;
  gap: 4px;
  padding: 4px 0;
}
.thinking-dots span {
  width: 6px;
  height: 6px;
  border-radius: 50%;
  background: var(--muted);
  animation: dotPulse 1.4s ease-in-out infinite;
}
.thinking-dots span:nth-child(2) { animation-delay: 0.2s; }
.thinking-dots span:nth-child(3) { animation-delay: 0.4s; }

/* New messages indicator */
.new-messages-btn {
  position: absolute;
  bottom: 90px;
  left: 50%;
  transform: translateX(-50%);
  display: none;
  align-items: center;
  gap: 6px;
  padding: 6px 14px;
  font-family: var(--font-body);
  font-size: 12px;
  font-weight: 500;
  color: var(--text-strong);
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: var(--radius-full);
  box-shadow: var(--shadow-md);
  cursor: pointer;
  z-index: 5;
  animation: fadeIn var(--duration-fast) var(--ease-out);
}
.new-messages-btn.visible { display: flex; }
.new-messages-btn svg { width: 14px; height: 14px; }

/* ═══════════════════════════════════════════════════════════════
   COMPOSE AREA
   ═══════════════════════════════════════════════════════════════ */
.chat-compose {
  position: relative;
  padding: 0 16px 16px;
  background: linear-gradient(to bottom, transparent, var(--bg) 30%);
  padding-top: 24px;
}

.chat-compose-inner {
  max-width: 800px;
  margin: 0 auto;
  display: flex;
  gap: 8px;
  align-items: flex-end;
}

.chat-compose textarea {
  flex: 1;
  min-height: 40px;
  max-height: 150px;
  padding: 10px 14px;
  font-family: var(--font-body);
  font-size: 14px;
  line-height: 1.5;
  color: var(--text);
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: var(--radius-md);
  resize: none;
  overflow-y: auto;
  transition: border-color var(--duration-fast) var(--ease-out),
              box-shadow var(--duration-fast) var(--ease-out);
}
.chat-compose textarea:focus {
  border-color: var(--accent);
  box-shadow: 0 0 0 3px var(--focus-ring);
  outline: none;
}
.chat-compose textarea::placeholder {
  color: var(--muted);
}

.chat-compose .send-btn {
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--accent);
  color: #fff;
  border: none;
  border-radius: var(--radius-md);
  cursor: pointer;
  flex-shrink: 0;
  transition: all var(--duration-fast) var(--ease-out);
}
.chat-compose .send-btn:hover {
  background: var(--accent-hover);
  transform: translateY(-1px);
  box-shadow: 0 4px 12px var(--accent-glow);
}
.chat-compose .send-btn:active {
  transform: translateY(0);
}
.chat-compose .send-btn:disabled {
  opacity: 0.4;
  cursor: not-allowed;
  transform: none;
  box-shadow: none;
}
.chat-compose .send-btn svg { width: 18px; height: 18px; }

/* Loading spinner in send button */
.send-btn .spinner {
  width: 18px;
  height: 18px;
  border: 2px solid rgba(255, 255, 255, 0.3);
  border-top-color: #fff;
  border-radius: 50%;
  animation: spin 0.6s linear infinite;
}

/* Unpair link */
.chat-footer {
  max-width: 800px;
  margin: 0 auto;
  padding-top: 8px;
  text-align: center;
}
.unpair-btn {
  font-family: var(--font-body);
  font-size: 12px;
  color: var(--muted);
  background: none;
  border: none;
  cursor: pointer;
  padding: 4px 8px;
  border-radius: var(--radius-sm);
  transition: color var(--duration-fast) var(--ease-out);
}
.unpair-btn:hover { color: var(--text); }

/* Chat error */
.chat-error {
  max-width: 800px;
  margin: 8px auto 0;
  font-size: 13px;
  color: var(--danger);
  text-align: center;
  min-height: 0;
}

/* ═══════════════════════════════════════════════════════════════
   ANIMATIONS
   ═══════════════════════════════════════════════════════════════ */
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(6px); }
  to { opacity: 1; transform: translateY(0); }
}

@keyframes streamPulse {
  0%, 100% { border-color: var(--accent); }
  50% { border-color: var(--border); }
}

@keyframes dotPulse {
  0%, 80%, 100% { opacity: 0.3; transform: scale(0.8); }
  40% { opacity: 1; transform: scale(1); }
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* ═══════════════════════════════════════════════════════════════
   RESPONSIVE
   ═══════════════════════════════════════════════════════════════ */
@media (max-width: 768px) {
  .topbar { padding: 0 12px; }
  .topbar-brand-text { font-size: 14px; }
  .topbar-status span:not(.status-dot) { display: none; }
  .chat-thread { padding: 12px 8px 8px; }
  .chat-compose { padding: 0 8px 12px; padding-top: 20px; }
  .chat-group { gap: 8px; }
  .chat-avatar { width: 30px; height: 30px; font-size: 12px; }
  .pair-card { padding: 32px 20px; }
}

/* Reduced motion */
@media (prefers-reduced-motion: reduce) {
  *, *::before, *::after {
    animation-duration: 0.01ms !important;
    transition-duration: 0.01ms !important;
  }
}
  </style>
</head>
<body>
  <div class="shell">
    <!-- TOPBAR -->
    <header class="topbar">
      <div class="topbar-brand">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
          <path d="M6 3h12l4 6-10 13L2 9z"/>
          <path d="M12 22V9"/>
          <path d="M2 9h20"/>
          <path d="M6 3l6 6 6-6"/>
        </svg>
        <span class="topbar-brand-text">ZeroClaw</span>
      </div>

      <div class="topbar-spacer"></div>

      <div class="topbar-status" id="status-pill">
        <span class="status-dot unknown" id="status-dot"></span>
        <span id="status-text">Connecting...</span>
      </div>

      <div class="topbar-actions">
        <button class="icon-btn" id="btn-theme" title="Toggle theme" aria-label="Toggle theme">
          <!-- Sun icon (shown in dark mode) -->
          <svg id="icon-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="5"/>
            <line x1="12" y1="1" x2="12" y2="3"/>
            <line x1="12" y1="21" x2="12" y2="23"/>
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
            <line x1="1" y1="12" x2="3" y2="12"/>
            <line x1="21" y1="12" x2="23" y2="12"/>
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
          </svg>
          <!-- Moon icon (shown in light mode) -->
          <svg id="icon-moon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="display:none">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
          </svg>
        </button>
      </div>
    </header>

    <!-- CONTENT -->
    <main class="content">
      <!-- PAIRING VIEW -->
      <div id="view-pair" class="view pair-view">
        <div class="pair-card">
          <div class="pair-card-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
              <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
              <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
            </svg>
          </div>
          <h2>Pair your device</h2>
          <p>Enter the 6-digit code shown in your terminal when the gateway started.</p>
          <form id="form-pair">
            <input
              type="text"
              class="pair-input"
              id="pair-code"
              inputmode="numeric"
              pattern="[0-9]*"
              maxlength="6"
              placeholder="000000"
              autocomplete="one-time-code"
              autofocus
            />
            <button type="submit" class="btn btn-primary btn-full" id="btn-pair">Pair</button>
            <div class="error-msg" id="pair-error" aria-live="polite"></div>
          </form>
        </div>
      </div>

      <!-- CHAT VIEW -->
      <div id="view-chat" class="view chat-view">
        <div class="chat-thread" id="chat-thread">
          <div class="chat-thread-inner" id="chat-messages">
            <!-- Empty state (shown when no messages) -->
            <div class="chat-empty" id="chat-empty">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
              </svg>
              <h3>Start a conversation</h3>
              <p>Send a message to begin chatting with your ZeroClaw agent.</p>
            </div>
          </div>
        </div>

        <!-- New messages indicator -->
        <button class="new-messages-btn" id="btn-scroll-bottom">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="6 9 12 15 18 9"/>
          </svg>
          New messages
        </button>

        <!-- Compose -->
        <div class="chat-compose">
          <div class="chat-compose-inner">
            <textarea
              id="chat-input"
              placeholder="Type a message..."
              rows="1"
            ></textarea>
            <button type="button" class="send-btn" id="btn-send" disabled>
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <line x1="22" y1="2" x2="11" y2="13"/>
                <polygon points="22 2 15 22 11 13 2 9 22 2"/>
              </svg>
            </button>
          </div>
          <div class="chat-error" id="chat-error" aria-live="polite"></div>
          <div class="chat-footer">
            <button type="button" class="unpair-btn" id="btn-unpair">Unpair &middot; use a different code</button>
          </div>
        </div>
      </div>
    </main>
  </div>

  <script>
(function () {
  'use strict';

  // ════════════════════════════════════════════════════════════
  // STATE
  // ════════════════════════════════════════════════════════════
  var STORAGE_KEY = 'zeroclaw_bearer';
  var THEME_KEY = 'zeroclaw_theme';
  var messages = []; // { role: 'user'|'assistant', text: string, model?: string }
  var isSending = false;

  // DOM refs
  var viewPair = document.getElementById('view-pair');
  var viewChat = document.getElementById('view-chat');
  var formPair = document.getElementById('form-pair');
  var pairCode = document.getElementById('pair-code');
  var pairError = document.getElementById('pair-error');
  var btnPair = document.getElementById('btn-pair');
  var chatThread = document.getElementById('chat-thread');
  var chatMessages = document.getElementById('chat-messages');
  var chatEmpty = document.getElementById('chat-empty');
  var chatInput = document.getElementById('chat-input');
  var chatError = document.getElementById('chat-error');
  var btnSend = document.getElementById('btn-send');
  var btnUnpair = document.getElementById('btn-unpair');
  var btnTheme = document.getElementById('btn-theme');
  var iconSun = document.getElementById('icon-sun');
  var iconMoon = document.getElementById('icon-moon');
  var statusDot = document.getElementById('status-dot');
  var statusText = document.getElementById('status-text');
  var btnScrollBottom = document.getElementById('btn-scroll-bottom');

  // ════════════════════════════════════════════════════════════
  // THEME
  // ════════════════════════════════════════════════════════════
  function getPreferredTheme() {
    var saved = localStorage.getItem(THEME_KEY);
    if (saved === 'light' || saved === 'dark') return saved;
    return window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark';
  }

  function applyTheme(theme) {
    document.documentElement.setAttribute('data-theme', theme);
    localStorage.setItem(THEME_KEY, theme);
    iconSun.style.display = theme === 'dark' ? '' : 'none';
    iconMoon.style.display = theme === 'light' ? '' : 'none';
  }

  btnTheme.addEventListener('click', function () {
    var current = document.documentElement.getAttribute('data-theme');
    applyTheme(current === 'dark' ? 'light' : 'dark');
  });

  applyTheme(getPreferredTheme());

  // ════════════════════════════════════════════════════════════
  // TOKEN
  // ════════════════════════════════════════════════════════════
  function getToken() { return localStorage.getItem(STORAGE_KEY); }
  function setToken(t) { localStorage.setItem(STORAGE_KEY, t); }
  function clearToken() { localStorage.removeItem(STORAGE_KEY); }

  // ════════════════════════════════════════════════════════════
  // VIEW SWITCHING
  // ════════════════════════════════════════════════════════════
  function showView(name) {
    viewPair.classList.toggle('active', name === 'pair');
    viewChat.classList.toggle('active', name === 'chat');
    if (name === 'pair') {
      pairError.textContent = '';
      pairCode.value = '';
      setTimeout(function () { pairCode.focus(); }, 100);
    } else {
      chatError.textContent = '';
      setTimeout(function () { chatInput.focus(); }, 100);
    }
  }

  // ════════════════════════════════════════════════════════════
  // MARKDOWN PARSER (lightweight)
  // ════════════════════════════════════════════════════════════
  function escapeHtml(str) {
    return str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
  }

  function parseMarkdown(text) {
    // Extract code blocks first to protect them
    var codeBlocks = [];
    text = text.replace(/```(\w*)\n?([\s\S]*?)```/g, function (_, lang, code) {
      var idx = codeBlocks.length;
      codeBlocks.push({ lang: lang, code: code.replace(/\n$/, '') });
      return '\x00CODEBLOCK' + idx + '\x00';
    });

    // Process line by line
    var lines = text.split('\n');
    var html = '';
    var inList = false;
    var listType = '';
    var inBlockquote = false;

    for (var i = 0; i < lines.length; i++) {
      var line = lines[i];

      // Code block placeholder
      var cbMatch = line.match(/^\x00CODEBLOCK(\d+)\x00$/);
      if (cbMatch) {
        if (inList) { html += '</' + listType + '>'; inList = false; }
        if (inBlockquote) { html += '</blockquote>'; inBlockquote = false; }
        var cb = codeBlocks[parseInt(cbMatch[1])];
        html += '<pre><code>' + escapeHtml(cb.code) + '</code>'
          + '<button class="code-copy-btn" onclick="copyCode(this)" title="Copy code">'
          + '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>'
          + '</button></pre>';
        continue;
      }

      // Blockquote
      if (line.match(/^>\s?/)) {
        if (inList) { html += '</' + listType + '>'; inList = false; }
        if (!inBlockquote) { html += '<blockquote>'; inBlockquote = true; }
        html += inlineMarkdown(escapeHtml(line.replace(/^>\s?/, ''))) + '<br>';
        continue;
      } else if (inBlockquote) {
        html += '</blockquote>';
        inBlockquote = false;
      }

      // Heading
      var hMatch = line.match(/^(#{1,6})\s+(.+)/);
      if (hMatch) {
        if (inList) { html += '</' + listType + '>'; inList = false; }
        var level = hMatch[1].length;
        html += '<strong>' + inlineMarkdown(escapeHtml(hMatch[2])) + '</strong><br>';
        continue;
      }

      // Horizontal rule
      if (line.match(/^(-{3,}|_{3,}|\*{3,})$/)) {
        if (inList) { html += '</' + listType + '>'; inList = false; }
        html += '<hr>';
        continue;
      }

      // Unordered list
      if (line.match(/^[\s]*[-*+]\s+/)) {
        if (!inList || listType !== 'ul') {
          if (inList) html += '</' + listType + '>';
          html += '<ul>';
          inList = true;
          listType = 'ul';
        }
        html += '<li>' + inlineMarkdown(escapeHtml(line.replace(/^[\s]*[-*+]\s+/, ''))) + '</li>';
        continue;
      }

      // Ordered list
      var olMatch = line.match(/^[\s]*(\d+)\.\s+(.+)/);
      if (olMatch) {
        if (!inList || listType !== 'ol') {
          if (inList) html += '</' + listType + '>';
          html += '<ol>';
          inList = true;
          listType = 'ol';
        }
        html += '<li>' + inlineMarkdown(escapeHtml(olMatch[2])) + '</li>';
        continue;
      }

      // Close list if we're in one and this isn't a list item
      if (inList) { html += '</' + listType + '>'; inList = false; }

      // Blank line = paragraph break
      if (line.trim() === '') {
        html += '<br>';
        continue;
      }

      // Normal text
      html += '<p>' + inlineMarkdown(escapeHtml(line)) + '</p>';
    }

    if (inList) html += '</' + listType + '>';
    if (inBlockquote) html += '</blockquote>';

    return html;
  }

  function inlineMarkdown(text) {
    // Bold
    text = text.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
    text = text.replace(/__(.+?)__/g, '<strong>$1</strong>');
    // Italic
    text = text.replace(/\*(.+?)\*/g, '<em>$1</em>');
    text = text.replace(/_(.+?)_/g, '<em>$1</em>');
    // Inline code
    text = text.replace(/`([^`]+)`/g, '<code>$1</code>');
    // Links
    text = text.replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank" rel="noopener">$1</a>');
    return text;
  }

  // Global: copy code block content
  window.copyCode = function (btn) {
    var pre = btn.closest('pre');
    var code = pre.querySelector('code');
    navigator.clipboard.writeText(code.textContent).then(function () {
      btn.classList.add('copied');
      setTimeout(function () { btn.classList.remove('copied'); }, 1500);
    });
  };

  // ════════════════════════════════════════════════════════════
  // CHAT RENDERING
  // ════════════════════════════════════════════════════════════
  function renderMessages() {
    // Clear everything except the empty state
    var children = chatMessages.children;
    for (var i = children.length - 1; i >= 0; i--) {
      if (children[i] !== chatEmpty) chatMessages.removeChild(children[i]);
    }

    chatEmpty.style.display = messages.length === 0 ? '' : 'none';

    // Group consecutive messages by role
    var groups = [];
    for (var j = 0; j < messages.length; j++) {
      var msg = messages[j];
      var lastGroup = groups[groups.length - 1];
      if (lastGroup && lastGroup.role === msg.role) {
        lastGroup.items.push(msg);
      } else {
        groups.push({ role: msg.role, items: [msg] });
      }
    }

    for (var g = 0; g < groups.length; g++) {
      var group = groups[g];
      var isUser = group.role === 'user';

      var groupEl = document.createElement('div');
      groupEl.className = 'chat-group ' + group.role;

      // Avatar
      var avatar = document.createElement('div');
      avatar.className = 'chat-avatar ' + (isUser ? 'user-avatar' : 'assistant-avatar');
      avatar.textContent = isUser ? 'Y' : 'Z';
      groupEl.appendChild(avatar);

      // Body
      var body = document.createElement('div');
      body.className = 'chat-group-body';

      // Sender label
      var sender = document.createElement('div');
      sender.className = 'chat-sender';
      if (isUser) {
        sender.textContent = 'You';
      } else {
        var model = group.items[0].model;
        sender.textContent = model ? 'ZeroClaw (' + model + ')' : 'ZeroClaw';
      }
      body.appendChild(sender);

      // Bubbles
      for (var b = 0; b < group.items.length; b++) {
        var item = group.items[b];
        var bubble = document.createElement('div');
        bubble.className = 'chat-bubble';

        if (isUser) {
          bubble.textContent = item.text;
        } else if (item.loading) {
          bubble.classList.add('streaming');
          bubble.innerHTML = '<div class="thinking-dots"><span></span><span></span><span></span></div>';
        } else {
          bubble.innerHTML = parseMarkdown(item.text);
          // Copy button
          var copyBtn = document.createElement('button');
          copyBtn.className = 'copy-btn';
          copyBtn.title = 'Copy';
          copyBtn.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>';
          copyBtn.addEventListener('click', (function (t) {
            return function () {
              navigator.clipboard.writeText(t).then(function () {
                copyBtn.classList.add('copied');
                setTimeout(function () { copyBtn.classList.remove('copied'); }, 1500);
              });
            };
          })(item.text));
          bubble.appendChild(copyBtn);
        }

        body.appendChild(bubble);
      }

      groupEl.appendChild(body);
      chatMessages.appendChild(groupEl);
    }
  }

  // ════════════════════════════════════════════════════════════
  // AUTO-SCROLL
  // ════════════════════════════════════════════════════════════
  var userScrolledUp = false;

  chatThread.addEventListener('scroll', function () {
    var threshold = 80;
    var atBottom = chatThread.scrollHeight - chatThread.scrollTop - chatThread.clientHeight < threshold;
    userScrolledUp = !atBottom;
    btnScrollBottom.classList.toggle('visible', userScrolledUp && messages.length > 0);
  });

  btnScrollBottom.addEventListener('click', function () {
    scrollToBottom(true);
  });

  function scrollToBottom(force) {
    if (!force && userScrolledUp) return;
    chatThread.scrollTop = chatThread.scrollHeight;
    userScrolledUp = false;
    btnScrollBottom.classList.remove('visible');
  }

  // ════════════════════════════════════════════════════════════
  // TEXTAREA AUTO-RESIZE & KEYBOARD
  // ════════════════════════════════════════════════════════════
  chatInput.addEventListener('input', function () {
    this.style.height = 'auto';
    this.style.height = Math.min(this.scrollHeight, 150) + 'px';
    btnSend.disabled = this.value.trim() === '' || isSending;
  });

  chatInput.addEventListener('keydown', function (e) {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      if (!isSending && this.value.trim()) sendMessage();
    }
  });

  // ════════════════════════════════════════════════════════════
  // PAIRING
  // ════════════════════════════════════════════════════════════
  formPair.addEventListener('submit', function (e) {
    e.preventDefault();
    var code = pairCode.value.trim().replace(/\D/g, '').slice(0, 6);
    if (code.length !== 6) {
      pairError.textContent = 'Please enter a 6-digit code.';
      return;
    }
    pairError.textContent = '';
    btnPair.disabled = true;
    btnPair.textContent = 'Pairing...';

    fetch('/pair', {
      method: 'POST',
      headers: { 'X-Pairing-Code': code }
    })
      .then(function (res) { return res.json().then(function (body) { return { res: res, body: body }; }); })
      .then(function (ref) {
        btnPair.disabled = false;
        btnPair.textContent = 'Pair';
        if (ref.res.ok && ref.body.token) {
          setToken(ref.body.token);
          showView('chat');
        } else {
          pairError.textContent = ref.body.error || 'Pairing failed.';
        }
      })
      .catch(function () {
        btnPair.disabled = false;
        btnPair.textContent = 'Pair';
        pairError.textContent = 'Network error. Is the gateway running?';
      });
  });

  // ════════════════════════════════════════════════════════════
  // CHAT / SEND
  // ════════════════════════════════════════════════════════════
  btnSend.addEventListener('click', function () {
    if (!isSending && chatInput.value.trim()) sendMessage();
  });

  function sendMessage() {
    var text = chatInput.value.trim();
    if (!text) return;
    var token = getToken();
    if (!token) { showView('pair'); return; }

    chatError.textContent = '';
    isSending = true;

    // Add user message
    messages.push({ role: 'user', text: text });
    // Add loading placeholder
    messages.push({ role: 'assistant', text: '', loading: true });
    renderMessages();
    scrollToBottom(true);

    chatInput.value = '';
    chatInput.style.height = 'auto';
    btnSend.disabled = true;

    // Show spinner
    btnSend.innerHTML = '<div class="spinner"></div>';

    fetch('/webhook', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': 'Bearer ' + token
      },
      body: JSON.stringify({ message: text })
    })
      .then(function (res) { return res.json().then(function (body) { return { res: res, body: body }; }); })
      .then(function (ref) {
        // Remove loading placeholder
        messages = messages.filter(function (m) { return !m.loading; });

        if (ref.res.status === 401) {
          clearToken();
          messages = [];
          showView('pair');
          return;
        }
        if (ref.res.ok && ref.body.response !== undefined) {
          messages.push({ role: 'assistant', text: ref.body.response, model: ref.body.model });
        } else {
          chatError.textContent = ref.body.error || 'Request failed.';
        }
        renderMessages();
        scrollToBottom(true);
      })
      .catch(function () {
        messages = messages.filter(function (m) { return !m.loading; });
        renderMessages();
        chatError.textContent = 'Network error.';
      })
      .finally(function () {
        isSending = false;
        btnSend.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>';
        btnSend.disabled = chatInput.value.trim() === '';
      });
  }

  // ════════════════════════════════════════════════════════════
  // UNPAIR
  // ════════════════════════════════════════════════════════════
  btnUnpair.addEventListener('click', function () {
    clearToken();
    messages = [];
    renderMessages();
    showView('pair');
  });

  // ════════════════════════════════════════════════════════════
  // STATUS POLLING
  // ════════════════════════════════════════════════════════════
  function formatUptime(secs) {
    if (!secs || secs < 0) return '';
    var h = Math.floor(secs / 3600);
    var m = Math.floor((secs % 3600) / 60);
    if (h > 0) return h + 'h ' + m + 'm';
    if (m > 0) return m + 'm';
    return '<1m';
  }

  function pollStatus() {
    fetch('/health')
      .then(function (res) { return res.json(); })
      .then(function (data) {
        var status = data.status || 'unknown';
        statusDot.className = 'status-dot ' + (status === 'ok' ? 'ok' : status === 'degraded' ? 'warn' : 'error');

        var label = status === 'ok' ? 'Healthy' : status;
        var uptime = data.runtime && data.runtime.uptime_seconds
          ? ' \u00b7 ' + formatUptime(data.runtime.uptime_seconds)
          : '';
        statusText.textContent = label + uptime;
      })
      .catch(function () {
        statusDot.className = 'status-dot error';
        statusText.textContent = 'Offline';
      });
  }

  pollStatus();
  setInterval(pollStatus, 30000);

  // ════════════════════════════════════════════════════════════
  // INIT
  // ════════════════════════════════════════════════════════════
  if (getToken()) {
    showView('chat');
  } else {
    showView('pair');
  }
})();
  </script>
</body>
</html>
